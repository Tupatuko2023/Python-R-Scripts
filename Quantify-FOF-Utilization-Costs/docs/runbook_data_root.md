# DATA_ROOT Architecture

This document describes the directory structure of the external `DATA_ROOT` used for this project.
This structure is required to comply with "Option B" data governance (no raw data in repo).

## Directory Structure

```text
DATA_ROOT/
├── raw/                 # Raw data received from external sources (Read-Only for scripts)
│   ├── paper_02/        # Specific data for Paper 02
│   │   ├── KAAOS_data_sotullinen.xlsx
│   │   └── sotut.xlsx
│   └── ...
├── staging/             # Intermediate data (Parquet) (Generated by ingest)
│   ├── paper_02_kaaos.parquet
│   └── ...
├── derived/             # Analysis-ready datasets (CSV/Parquet) (Generated by build)
│   ├── aim2_panel.csv
│   └── ...
├── manifest/            # Audit logs
│   ├── manifest.csv     # Log of all file operations
│   └── run_log.csv      # Execution log
└── data/                # Legacy/Alternative path (migrating to derived)
    └── kaatumisenpelko.csv
```

## Workflow

1.  **Ingest (`R/01_ingest.R`):** Reads files from `raw/`, validates columns against `config/ingest_config.yaml`, and writes standardized Parquet files to `staging/`.
2.  **Build (`R/02_build_derived.R`):** Reads from `staging/`, performs joins (e.g., Frailty lookup), and writes analysis-ready files to `derived/`.
3.  **Analysis:** Scripts read _only_ from `derived/`.

## Manifest

All write operations to `staging/` and `derived/` must be appended to `manifest/manifest.csv` with the following columns:

- `timestamp`: ISO 8601 time
- `file`: Relative path to the file
- `hash`: SHA256 checksum
- `script`: The script that generated the file
